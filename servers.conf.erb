server {
  server_name localhost;
  listen <%= ENV['PORT'] %>;

  # Disable compression that is performed by the Scalingo router anyway
  gzip off;

  rewrite_log on;
  server_name_in_redirect off;
  port_in_redirect on;
  
  location /documentation {
    rewrite /documentation/(.*) /communaute/$1  break;
    proxy_pass       https://doc.incubateur.net;
    proxy_set_header Host            doc.incubateur.net;
    proxy_set_header X-Forwarded-For $remote_addr;
  }

  location / {
    # _redirects
    rewrite ^/incubateur/(.*)$ $scheme://$http_host/startups/?incubateur=$1 redirect;
    rewrite ^/incubateurs/(.*)$ $scheme://$http_host/startups/?incubateur=$1 redirect;
    rewrite ^/startup/(.*)$ $scheme://$http_host/startups/$1 redirect;
    rewrite ^/alpha/mooc/(.*)$ $scheme://$http_host/approche/formation/mooc/$1 redirect;
    
    error_page 404 /404.html;
    root /app/_site;
    index index.html;

    try_files $uri $uri.html $uri/index.html $uri/ index.html =404;
  }
}
